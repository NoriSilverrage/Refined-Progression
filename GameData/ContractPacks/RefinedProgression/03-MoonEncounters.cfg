//--
//------ Refined Progression Contracts
//--

//----Contains
//
//--Moon Missions (Mun/Minmus or Serran/Aptur/Mun)
//FirstFlyBys
//FirstOrbits
//FirstLandings


//--First Fly By
CONTRACT_TYPE
{
    name = FirstFlyBys
	group = CloseExplorer
	
	title = Perform your first fly by of @targetBody
	description = Our fellow Kerbals have long known of @targetBody. With our recent exploration endeavours our team believes we can complete a close, @/targetAlt meter, flyby.
	synopsis = Perform a Flyby of @targetBody
	completedMessage = Up close @targetBody is even more marvellous.

	agent = Experimental Astrophysics Group

	deadline = 213
	prestige = Significant
	targetBody = @/validTarget
	weight = 2.0
	maxSimultaneous = 2
	rewardScience = 4.0
	rewardReputation = 8.0
	rewardFunds = 40000
	failureFunds = 10000
	failureReputation = 4.0
	advanceFunds = 10000
	
    DATA
    {
        type = bool
        homeIsPlanet = HomeWorld().Parent() == Sun
    }

    DATA
    {
        type = CelestialBody
		activeUniqueValue = true
        validTarget = @homeIsPlanet ? HomeWorld().Children().Where(cb => cb.HaveReached() == false).Random() : HomeWorld().Parent().Children().Where(cb => cb.HaveReached() == false && cb.IsHomeWorld() == false).Random()
    }
	
	DATA
    {
        type = float
        targetAlt = @targetBody.SpaceAltitudeThreshold()/1.1
    }
	 
	REQUIREMENT
	{
		name = Any
		type = Any
		
		REQUIREMENT
		{
			name = CompleteContract
			type = CompleteContract
			contractType = EscapeHomeWorld
		}
		
		REQUIREMENT
		{
			name = CompleteContract
			type = CompleteContract
			contractType = UMEscapeHomeworld
		}
	}
	
	PARAMETER
	{
		name = flyby
		type = VesselParameterGroup
		
		title = Complete a Flyby of @targetBody
		
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			minCrew = 0
			maxCrew = 0
		}
		
		PARAMETER
		{
			name = ReachState
			type = ReachState
			maxAltitude = @/targetAlt
		}
	}
}



//--First orbits with optional landing
CONTRACT_TYPE
{
    name = FirstOrbits
	group = CloseExplorer
	
	title = Orbit @targetBody
	description = Now that we have scouted out @targetBody we think it is time to orbit someone there. They should probably make it home too with a wee bit of science. 
	Bonuses in store for any Kerbal that happens to land too.
	synopsis = Orbit and return from @targetBody. Optionally land.
	completedMessage = Stupendous job! This is a great step for all Kebalkind.

	agent = Experimental Astrophysics Group

	deadline = 213
	prestige = Exceptional
	targetBody = @/validTarget
	weight = 2.0
	maxSimultaneous = 2
	rewardScience = 8.0
	rewardReputation = 16.0
	rewardFunds = 60000
	failureFunds = 15000
	failureReputation = 8.0
	advanceFunds = 15000
	
    DATA
    {
        type = bool
        homeIsPlanet = HomeWorld().Parent() == Sun
    }

    DATA
    {
        type = CelestialBody
		activeUniqueValue = true
        validTarget = @/homeIsPlanet ? HomeWorld().Children().Where(cb => cb.HaveReached() && cb.HaveLandedOn() == false).Random() : HomeWorld().Parent().Children().Where(cb => cb.HaveReached() && cb.HaveLandedOn() == false && cb.IsHomeWorld() == false).Random()
	}

	 
	REQUIREMENT
	{
		name = Any
		type = Any
		
		REQUIREMENT
		{
			name = CompleteContract
			type = CompleteContract
			contractType = EscapeHomeWorld
		}
		
		REQUIREMENT
		{
			name = CompleteContract
			type = CompleteContract
			contractType = UMEscapeHomeworld
		}
	}
	
	PARAMETER
	{
		name = crewedorbit
		type = VesselParameterGroup
		duration = 60m
		title = Achieve orbit of @targetBody
		notes = Collect EVA Report, Temperature, Crew Report, and Mystery Goo for bonus. Landing also gives a bonus.

		
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			minCrew = 1
		}
		
		PARAMETER
		{
			name = Orbit
			type = Orbit
			maxApA = @targetBody.SpaceAltitudeThreshold() / 2
		}
		
		PARAMETER
		{
			name = landing
			type = ReachState
			optional = true
			
			notes = Optional: Jeb bets you can't land on your first encounter... Prove him wrong for a bonus and bragging rights!
			situation = LANDED
			rewardFunds = 30000
			rewardReputation = 10
		}
		
		PARAMETER
		{
			name = CollectScience
			type = CollectScience
			optional = true
			rewardFunds = 7500
			rewardReputation = 5
			
			location = Space
			notes = Optional: Collect several science experiements for a bonus.
			experiment = evaReport
			experiment = temperatureScan
			experiment = crewReport
			experiment = mysteryGoo
			
			recoveryMethod = RecoverOrTransmit
		}
	}
	
	
	PARAMETER
	{
		name = ReturnHome
		type = ReturnHome
	}
	
	BEHAVIOUR
	{
		name = AwardExperience
		type = AwardExperience
	
		parameter = crewedorbit
		experience = 1 / @targetBody.Multiplier()
	}
	
	BEHAVIOUR
	{
		name = AwardExperience
		type = AwardExperience
	
		parameter = landing
		experience = 2 / @targetBody.Multiplier()
	}
}



//--First landing
CONTRACT_TYPE
{
    name = FirstLandings
	group = CloseExplorer
	
	title = Land on @targetBody
	description = Now that we have achieved orbit of @targetBody the next step would be, well stepping on @targetBody. They should probably make it home too. 

	synopsis = Land and return from @targetBody.
	completedMessage = Stupendous job! This is a great step for all Kebalkind.

	agent = Experimental Astrophysics Group

	deadline = 213	
	prestige = Exceptional
	targetBody = @/validTarget
	weight = 2.0
	maxSimultaneous = 2
	rewardScience = 10.0
	rewardReputation = 20.0
	rewardFunds = 80000
	failureFunds = 20000
	failureReputation = 10.0
	advanceFunds = 20000
	
    DATA
    {
        type = bool
        homeIsPlanet = HomeWorld().Parent() == Sun
    }

    DATA
    {
        type = CelestialBody
		activeUniqueValue = true
        validTarget = @/homeIsPlanet ? HomeWorld().Children().Where(cb => cb.HaveOrbited() && cb.HaveLandedOn() == false).Random() : HomeWorld().Parent().Children().Where(cb => cb.HaveOrbited() && cb.HaveLandedOn() == false && cb.IsHomeWorld() == false).Random()
	}

	 
	REQUIREMENT
	{
		name = Any
		type = Any
		
		REQUIREMENT
		{
			name = CompleteContract
			type = CompleteContract
			contractType = EscapeHomeWorld
		}
		
		REQUIREMENT
		{
			name = CompleteContract
			type = CompleteContract
			contractType = UMEscapeHomeworld
		}
	}
	
	PARAMETER
	{
		name = crewedlanding
		type = VesselParameterGroup
		title = Land on @targetBody
		notes = Collect EVA Report, Temperature, Crew Report, Mystery Goo and Material Lab for bonus. Planting a flag also gives a bonus.
		
		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			minCrew = 1
		}

		PARAMETER
		{
			name = landing
			type = ReachState
			situation = LANDED 
		}
		
		PARAMETER
		{
			name = PlantFlag
			type = PlantFlag
			optional = true
			
			notes = Optional: Plant a flag for a bonus (funds, rep and XP).
			rewardFunds = 2500
			rewardReputation = 2
		}
		
		PARAMETER
		{
			name = CollectScience
			type = CollectScience
			optional = true
			rewardFunds = 10000
			rewardReputation = 5
			
			location = Surface
			notes = Optional: Collect several science experiements for a bonus (funds, rep and XP).
			experiment = evaReport
			experiment = temperatureScan
			experiment = crewReport
			experiment = mobileMaterialsLab
			experiment = mysteryGoo
			
			recoveryMethod = RecoverOrTransmit
		}
	}
	
	
	PARAMETER
	{
		name = ReturnHome
		type = ReturnHome
	}
	
	
	BEHAVIOUR
	{
		name = AwardExperience
		type = AwardExperience
	
		parameter = PlantFlag
		experience = 1 / @targetBody.Multiplier()
	}
	
	BEHAVIOUR
	{
		name = AwardExperience
		type = AwardExperience
	
		parameter = CollectScience
		experience = 1 / @targetBody.Multiplier()
	}
}